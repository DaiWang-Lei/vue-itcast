<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ç»„ä»¶æ¡ˆä¾‹-è¯„è®ºåˆ—è¡¨</title>
  <script src="../node_modules/vue/dist/vue.js"></script>
  <link rel="stylesheet" href="./boot-strap.css">
</head>

<body>
  <div id="app">
    <comment-box @func="loadComments"></comment-box>
    <ul class="list-group">
      <li class="list-group-item" v-for='item in list' :key="item.id">
        <span class="badge">å°ç¼–:{{item.user}}</span>
        {{item.content}}
        {{item.ctime}}
      </li>
    </ul>
  </div>
  <template id="tmpl">
    <div>
      <div class="form-group">
        <label for="">å°ç¼–:</label>
        <input type="text" class="form-control" v-model="user">
      </div>

      <div class="form-group">
        <label for="">è¯„è®ºå†…å®¹:</label>
        <textarea class="form-control" v-model="content" @keyup.enter='postComment'></textarea>
      </div>
      <div class="form-group">
        <input type="button" value="å‘è¡¨ğŸ‘€æ³•" class="btn btn-primary" @click="postComment">
      </div>
    </div>
  </template>


  <script>
    const commentBox = {
      template: "#tmpl",
      data() {
        return {
          user: '',
          content: '',
          ctime:`${new Date()}`,
        }
      },
      methods: {
        postComment() {
          // åˆ†æå‘è¡¨è¯„è®ºçš„ä¸šåŠ¡é€»è¾‘
          // 1.è¯„è®ºæ•°æ®å­˜æ”¾åˆ°localStorageä¸­,localStorage.setItem()
          // 2.å…ˆç»„ç»‡å‡ºä¸€ä¸ªæœ€æ–°çš„è¯„è®ºæ•°æ®å¯¹è±¡
          // 3.æŠŠç¬¬äºŒæ­¥å¾—åˆ°çš„è¯„è®ºå¯¹è±¡ï¼Œä¿å­˜åˆ°localStorage
          //  3.1 loaclStorageåªæ”¯æŒå­˜æ”¾å­—ç¬¦ä¸²æ•°æ®ï¼Œè¦å…ˆè°ƒç”¨JSON.stringfy()
          //  3.2 åœ¨ä¿å­˜ æœ€æ–°çš„ è¯„è®ºæ•°æ®ä¹‹å‰ï¼Œè¦å…ˆä»localStorageè·å–åˆ°ä¹‹å‰çš„è¯„è®ºæ•°æ®ï¼ˆstringï¼‰
          //     ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œç„¶åï¼ŒæŠŠæœ€æ–°çš„è¯„è®ºï¼Œpushåˆ°è¿™ä¸ªæ•°ç»„
          //  3.3 å¦‚æœè·å–åˆ°çš„localStorage ä¸­çš„ è¯„è®ºå­—ç¬¦ä¸²ï¼Œä¸ºç©ºä¸å­˜åœ¨ã€‚åˆ™å¯ä»¥è¿”å›ä¸€ä¸ªâ€˜ã€ã€‘â€™è®©JSON.parseå»è½¬æ¢
          //  3.4 æŠŠæœ€æ–°çš„ åˆ—è¡¨æ•°ç»„ï¼Œåœ¨æ­¤è°ƒç”¨JSON.stringfy()è½¬æ¢ä¸ºæ•°ç»„å­—ç¬¦ä¸²ã€‚ç„¶åè°ƒç”¨localStorage.setItemï¼ˆ
          const comment = { id: Date.now(), user: this.user, content: this.content ,ctime:this.ctime}
          // ä»localStorageä¸­è·å–æ‰€æœ‰çš„è¯„è®º 
          const list = JSON.parse(
            localStorage.getItem('cmts') || '[]'
          );
          list.unshift(comment);
          // ä¿å­˜æœ€æ–°çš„æ•°æ®
          localStorage.setItem('cmts', JSON.stringify(list));
          this.user = this.content = '';
          this.$emit('func');
          console.log(this.ctime);
        }
      }
    }


    var vm = new Vue({
      el: '#app',
      data: {
        list: [
          { id: Date.now() + 1, user: "æ¨æ…", content: 'æ˜¯éæˆè´¥è½¬å¤´ç©ºï¼Œé’å±±ä¾æ—§åœ¨ï¼Œå‡ åº¦å¤•é˜³çº¢' },
          { id: Date.now() + 2, user: "æç™½", content: 'å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨' },
          { id: Date.now() + 3, user: "æ–‡å¤©ç¥¥", content: 'äººç”Ÿè‡ªå¤è°æ— æ­»ï¼Œç•™å–ä¸¹å¿ƒç…§æ±—é’' }
        ]
      },
      methods: {
        loadComments() { // ä»æœ¬åœ°çš„localStorageä¸­ï¼ŒåŠ è½½è¯„è®ºåˆ—è¡¨
          const list = JSON.parse(localStorage.getItem('cmts' || '[]'));
          this.list = list;
        }
      },
      created() {
        this.loadComments();
      },
      components: {
        commentBox
      }
    });
  </script>
</body>

</html>