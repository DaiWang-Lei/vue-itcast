<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script src="../node_modules/vue/dist/vue.min.js"></script>
  <link rel="stylesheet" href="../lib/bootstrap.css">

</head>

<body>
  <div class="app">


    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">æ·»åŠ å“ç‰Œ</h3>
      </div>
      <div class="panel-body form-inline">
        <label>
          Id:
          <input type="text" class="form-control" v-model="id" :disabled='flag' v-focus>
        </label>

        <label>
          Name:
          <input type="text" class="form-control" v-model="name" @keyup.enter='add'>
        </label>

        <label>
          ğŸ”æœç´¢åç§°å…³é”®å­—:
          <input type="text" class="form-control" v-model="keywords">
        </label>


        <!-- ä½¿ç”¨v-on ç»‘å®šäº‹ä»¶æ—¶ï¼Œæ·»åŠ æ‹¬å·ï¼Œç”¨äºä¼ å‚ -->
        <input type="button" value="æäº¤" class="btn btn-primary" @click="add()" :disabled="submitflag">
      </div>
    </div>
    <table class="table table-hover table-bordered table-striped total ">
      <span><b>å“ç‰Œæ€»æ•°:</b></span>
      <span>{{total}}</span>
    </table>

    <table class="table table-hover table-bordered table-striped">
      <thead>
        <tr>
          <th>Id</th>
          <th>Name</th>
          <th>ctime</th>
          <th>Operation</th>
        </tr>
      </thead>
      <tbody>
        <!-- ä¹‹å‰ï¼Œ v-forä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯ç›´æ¥ä»dataä¸Šçš„listä¸­ç›´æ¥æ¸²æŸ“è¿‡æ¥çš„ï¼ -->
        <!-- ç°åœ¨è‡ªå®šä¹‰äº†searchæ–¹æ³•ï¼ŒåŒæ—¶æŠŠ æœç´¢çš„å…³é”®å­—é€šè¿‡ä¼ å‚çš„å½¢å¼ï¼Œä¼ é€’ç»™äº†serchæ–¹æ³• -->
        <!-- åœ¨ search æ–¹æ³•å†…éƒ¨ï¼Œé€šè¿‡ æ‰§è¡Œ for å¾ªç¯ï¼ŒæŠŠæ‰€æœ‰ç¬¦åˆ æœç´¢å…³é”®å­—çš„æ•°æ®ï¼Œä¿å­˜åˆ° ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­
      è¿”å› -->
        <tr v-for="item in search(keywords)" :key="item.id ">
          <td>{{item.id}}</td>
          <td v-text="item.name"></td>
          <td>{{item.ctime}}</td>
          <td>
            <a href="#" @click.prevent="toEdit(item.id)">ä¿®æ”¹</a>
            <span>|</span>
            <a href="#" @click.prevent="del(item.id)">åˆ é™¤</a>

          </td>
        </tr>
      </tbody>
    </table>

  </div>
  <script>
    Vue.directive('focus', {
      inserted(el) {
        el.focus();
      }
    })
    const vm = new Vue({
      el: ".app",
      data: {
        submitflag: false,
        flag: false,
        list: [],
        id: '',
        name: '',
        keywords: '' //æœç´¢çš„å…³é”®å­—
      },
      methods: {
        add() {
          if (this.flag) {
            //ç¼–è¾‘ä¿®æ”¹
            this.list.some((item) => {
              if (item.id == this.id) {
                item.name = this.name;
                return true;
              }
            });
            this.name = '';
            this.id = '';
            this.flag = !this.flag;
          } else {
            //æ·»åŠ 
            this.list.push({ id: this.id, name: this.name, ctime: new Date() });
          }
          this.id = this.name = " ";
        },
        toEdit(id) {
          //æ ¹æ®idæŸ¥è¯¢å‡ºè¦ç¼–è¾‘çš„æ•°æ®
          let list = this.list.filter((item) => {
            return item.id == id;
          })
          console.log(list);
          //æŠŠè·å–çš„ä¿¡æ¯å¡«å……åˆ°è¡¨å•
          this.id = list[0].id;
          this.name = list[0].name;
          //ç¦æ­¢ä¿®æ”¹idğŸˆ²ï¸
          this.flag = true;
        },
        del(id) {
          // this.list.some((item, i) => {
          //   if (item.id == id) {
          //     this.list.splice(i,1);
          //     // åœ¨æ•°ç»„çš„someæ–¹æ³•ä¸­ï¼Œå¦‚æœreturn trueï¼Œ å°±ä¼šç«‹å³ç»ˆæ­¢è¿™ä¸ªæ•°ç»„çš„åç»­å¾ªç¯
          //     return true;
          //   }
          // })

          const index = this.list.findIndex((item) => {
            if (item.id == id) {
              return true;
            }
          });
          //æ ¹æ®ç´¢å¼•åˆ é™¤æ•°ç»„å…ƒç´ 
          this.list.splice(index, 1);
        },
        search(keywords) { //æ ¹æ®å…³é”®å­—ï¼Œè¿›è¡Œæ•°æ®çš„æœç´¢
          // let newList = []
          // this.list.forEach(item => {
          //   if (item.name.indexOf(keywords) != -1){
          //     newList.push(item);
          //   }
          // })
          // return newList;

          // æ³¨æ„ ï¼š forEach some filter findIndex every éƒ½å±äºæ•°ç»„çš„æ–°æ–¹æ³•
          // éƒ½ä¼šå¯¹æ•°ç»„çš„æ¯ä¸€é¡¹ï¼Œè¿›è¡Œéå†ï¼Œæ‰§è¡Œç›¸å…³çš„æ“ä½œï¼›
          return this.list.filter(item => {
            // if(item.name.indexOf(keywords) != -1)
            // åœ¨ es6 ä¸­ï¼Œä¸ºå­—ç¬¦ä¸²æä¾›äº†ä¸€ä¸ªæ–°æ–¹æ³•ï¼Œå«åš String.prototype.includesï¼ˆâ€˜è¦åŒ…å«çš„å­—ç¬¦ä¸²â€™ï¼‰
            // å¦‚æœåŒ…å«è¿”å›trueï¼Œå¦åˆ™è¿”å›false
            if (item.name.includes(keywords)) {
              return item;
            }
          })
        }
      },
      computed: {
        total: function () {
          return this.list.length;
        }
      },
      watch: {
        name(val) {
          let flag = this.list.some((item) => {
            return item.name == val;
          });
          if (flag) {
            this.submitflag = true;
          } else {
            this.submitflag = false;
          }
        }
      },
      mounted: function () {
        let data = [
          { id: 1, name: 'åä¸º', ctime: new Date() },
          { id: 2, name: 'è‹¹æœğŸ', ctime: new Date() },
        ]
        this.list= data;
      }
    });
  </script>
</body>

</html>